var myApp=angular.module("myApp",["ngRoute"]);myApp.config(["$routeProvider","$locationProvider",function(a,b){b.hashPrefix(""),a.when("/home",{templateUrl:"/views/templates/home.html",controller:"LoginController"}).when("/register",{templateUrl:"/views/templates/register.html",controller:"LoginController"}).when("/user",{templateUrl:"/views/templates/user.html",controller:"UserController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).when("/info",{templateUrl:"/views/templates/info.html",controller:"InfoController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).when("/activate/:code",{templateUrl:"/views/templates/activate.html",controller:"ActivateController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).otherwise({redirectTo:"home"})}]),myApp.controller("ActivateController",["$scope","$http","$location","$routeParams","UserService",function(a,b,c,d,e){a.logout=e.logout,a.code=angular.copy(e.code),a.joinGroup=e.joinGroup,void 0!=d.code&&(a.code.tempCode=d.code),console.log("ActivateController loaded",a.code.tempCode)}]),myApp.controller("InfoController",["$scope","$http","$location","UserService",function(a,b,c,d){a.logout=d.logout}]),myApp.controller("LoginController",["$scope","$http","$location","UserService",function(a,b,c,d){a.user={username:"",password:""},a.message="",a.login=function(){""===a.user.username||""===a.user.password?a.message="Enter your username and password!":(console.log("sending to server...",a.user),b.post("/",a.user).then(function(b){b.data.username?(console.log("success: ",b.data),void 0!=d.code.tempCode?c.path("/activate/"+d.code.tempCode):c.path("/user")):(console.log("failure: ",b),a.message="Wrong!!")}))},a.registerUser=function(){""===a.user.username||""===a.user.password?a.message="Choose a username and password!":(console.log("sending to server...",a.user),b.post("/register",a.user).then(function(a){console.log("success"),void 0!=d.code.tempCode?c.path("/activate/"+d.code.tempCode):c.path("/user")},function(b){console.log("error"),a.message="Please try again."}))}}]),myApp.controller("UserController",["$scope","$http","$location","UserService",function(a,b,c,d){a.newGroup={},a.userObject=d.userObject,console.log(a.userObject),a.logout=d.logout,a.createGroup=d.createGroup,a.groups=d.groups,d.getGroups(),a.baseURL=c.$$protocol+"://"+c.$$host+":"+c.$$port}]),myApp.factory("UserService",["$http","$location","$route",function(a,b,c){console.log("User Service Loaded");var d={},e={},f={},g=function(){a.get("/group/").then(function(a){f.data=a.data})},h=function(c){a.put("/group/join/"+c).then(function(a){console.log(a),d.tempCode=void 0,b.path("/user")})},i=function(b){a.post("/group/create",{name:b}).then(function(a){console.log(a),g()})};return{userObject:e,code:d,groups:f,getuser:function(){a.get("/user").then(function(a){a.data.username?(e.userName=a.data.username,e.id=a.data._id,console.log("User Data: ",e.userName)):(d.tempCode=c.current.params.code,console.log("Activation code: ",c.current.params.code),b.path("/home"))})},logout:function(){a.get("/user/logout").then(function(a){console.log("logged out"),e.name="",e.id="",UserService.code.tempCode=void 0,b.path("/home")})},createGroup:i,joinGroup:h,getGroups:g}}]);